# Knative-Istio-EKS-Microservice

A comprehensive microservices architecture deployed on Amazon EKS with support for both **Traditional Kubernetes** and **Knative + Istio** deployment approaches.

## üèóÔ∏è Project Overview

This project demonstrates a complete microservices architecture with:
- **Infrastructure as Code** using Terraform AWS Modules
- **Two Deployment Approaches**: Traditional Kubernetes vs Knative + Istio
- **Event-Driven Architecture** with Kafka message broker
- **Secrets Management** with HashiCorp Vault
- **Auto-scaling** and **Load Balancing** capabilities
- **Production-ready** configuration with security best practices

## üèóÔ∏è System Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        AWS Infrastructure                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ   Terraform ‚îÇ ‚îÇ     EKS     ‚îÇ ‚îÇ    Kafka    ‚îÇ ‚îÇ    Vault    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ   (VPC +    ‚îÇ ‚îÇ   Cluster   ‚îÇ ‚îÇ   Message   ‚îÇ ‚îÇ   Secrets   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ   EKS)      ‚îÇ ‚îÇ             ‚îÇ ‚îÇ   Broker    ‚îÇ ‚îÇ Management  ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Application Layer                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ   Frontend  ‚îÇ ‚îÇ API Gateway ‚îÇ ‚îÇ  Identity   ‚îÇ ‚îÇ  Product    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ   Service   ‚îÇ ‚îÇ   Service   ‚îÇ ‚îÇ  Service    ‚îÇ ‚îÇ  Service    ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                ‚îÇ
‚îÇ  ‚îÇ   Order     ‚îÇ ‚îÇNotification ‚îÇ                                ‚îÇ
‚îÇ  ‚îÇ  Service    ‚îÇ ‚îÇ  Service    ‚îÇ                                ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                ‚îÇ ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Data Layer                                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                ‚îÇ
‚îÇ  ‚îÇ    MySQL    ‚îÇ ‚îÇ    Redis    ‚îÇ                                ‚îÇ
‚îÇ  ‚îÇ  Database   ‚îÇ ‚îÇ    Cache    ‚îÇ                                ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üìÅ Project Structure

```
.
‚îú‚îÄ‚îÄ README.md                    # This file - Project overview and structure
‚îú‚îÄ‚îÄ terraform/                   # Infrastructure as Code
‚îÇ   ‚îú‚îÄ‚îÄ README.md               # Terraform documentation
‚îÇ   ‚îú‚îÄ‚îÄ 0-providers.tf          # AWS provider configuration
‚îÇ   ‚îú‚îÄ‚îÄ 1-vpc.tf                # VPC and networking setup
‚îÇ   ‚îî‚îÄ‚îÄ 2-eks.tf                # EKS cluster configuration
‚îú‚îÄ‚îÄ stateful/                   # Traditional Kubernetes deployment
‚îÇ   ‚îú‚îÄ‚îÄ serivces/               # Application services
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api-gateway/        # API Gateway service
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ frontend/           # Frontend application
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ identity/           # Authentication service
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mysql/              # MySQL database
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ notification/       # Notification service
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ order/              # Order processing service
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ product/            # Product management service
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ redis/              # Redis cache
‚îÇ   ‚îú‚îÄ‚îÄ resources/              # Additional resources
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ing.yaml            # Ingress configuration
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ setup-alb-controller.sh # ALB Controller setup
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ iam_policy.json     # IAM policy for ALB Controller
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ vault/              # Vault configuration
‚îÇ   ‚îú‚îÄ‚îÄ deploy_stateful.sh      # Traditional deployment script
‚îÇ   ‚îî‚îÄ‚îÄ cleanup_stateful.sh     # Traditional cleanup script
‚îú‚îÄ‚îÄ knative/                    # Knative + Istio deployment
‚îÇ   ‚îú‚îÄ‚îÄ README.md               # Knative documentation
‚îÇ   ‚îú‚îÄ‚îÄ deploy_knative.sh       # Knative deployment script
‚îÇ   ‚îú‚îÄ‚îÄ cleanup_knative.sh      # Knative cleanup script
‚îÇ   ‚îú‚îÄ‚îÄ check_knative.sh        # Health check script
‚îÇ   ‚îú‚îÄ‚îÄ services/               # Knative service configurations
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api-gateway.yaml
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ frontend-service.yaml
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ identity-service.yaml
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ notification-service.yaml
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ order-service.yaml
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ product-service.yaml
‚îÇ   ‚îî‚îÄ‚îÄ istio/                  # Istio traffic management
‚îÇ       ‚îú‚îÄ‚îÄ gateway.yaml        # Istio Gateway
‚îÇ       ‚îî‚îÄ‚îÄ virtual-services.yaml # Istio VirtualServices
‚îú‚îÄ‚îÄ kafka/                      # Kafka infrastructure (Helm Chart)
‚îÇ   ‚îú‚îÄ‚îÄ README.md               # Kafka documentation
‚îÇ   ‚îú‚îÄ‚îÄ deploy_kafka.sh         # Kafka deployment script
‚îÇ   ‚îú‚îÄ‚îÄ kafka/                  # Helm chart directory
‚îÇ   ‚îú‚îÄ‚îÄ kafka-values.yaml       # Helm values
‚îÇ   ‚îî‚îÄ‚îÄ client.properties       # Client configuration
‚îî‚îÄ‚îÄ vault/                      # Vault infrastructure
    ‚îú‚îÄ‚îÄ README.md               # Vault documentation
    ‚îú‚îÄ‚îÄ deploy_vault.sh         # Vault deployment script
    ‚îî‚îÄ‚îÄ vault-ing.yaml          # Vault configuration
```

## üöÄ Quick Start

### Prerequisites

1. **AWS CLI** configured with appropriate permissions
2. **Terraform** (>= 1.0)
3. **kubectl** (>= 1.24)
4. **helm** (>= 3.0)
5. **istioctl** (for Knative deployment)

### Step 1: Deploy Infrastructure

```bash
# Navigate to terraform directory
cd terraform

# Initialize and deploy infrastructure
terraform init
terraform plan
terraform apply

# Configure kubectl for the new cluster
aws eks update-kubeconfig --region us-east-1 --name datnghiem-eks

# Verify cluster access
kubectl cluster-info
```

### Step 2: Choose Deployment Approach

#### **Approach 1: Traditional Kubernetes Deployment**

```bash
# Deploy traditional services with ALB Controller
./deploy_stateful.sh
```

#### **Approach 2: Knative + Istio Deployment**

```bash
# Deploy Knative services with Istio
cd knative
./deploy_knative.sh
```

### Step 3: Deploy Infrastructure Services (Optional)

```bash
# Deploy Kafka (Helm Chart)
cd kafka
./deploy_kafka.sh

# Deploy Vault
cd ../vault
./deploy_vault.sh
```

## üîß Deployment Approaches

### **Traditional Kubernetes Deployment (`stateful/`)**

**Features:**
- ‚úÖ Standard Kubernetes deployments and services
- ‚úÖ ALB Controller for AWS Load Balancer integration
- ‚úÖ Ingress-based routing
- ‚úÖ Familiar Kubernetes concepts
- ‚úÖ Easy to understand and debug

**Use Cases:**
- Learning and development
- Teams familiar with Kubernetes
- Simple microservices architecture
- Cost-effective for small to medium workloads

### **Knative + Istio Deployment (`knative/`)**

**Features:**
- ‚úÖ Serverless auto-scaling (scale to zero)
- ‚úÖ Advanced traffic management with Istio
- ‚úÖ Blue-green deployments
- ‚úÖ Service mesh capabilities
- ‚úÖ Event-driven architecture

**Use Cases:**
- Production workloads with variable traffic
- Advanced traffic management requirements
- Serverless architecture goals
- Event-driven microservices

## üåê Service Architecture

### **Core Services**

| Service | Purpose | Port | Technology |
|---------|---------|------|------------|
| **Frontend** | Web application | 80 | Static web app |
| **API Gateway** | Main entry point | 8080 | Spring Boot |
| **Identity** | Authentication | 9898 | Spring Boot |
| **Product** | Product management | 8082 | Spring Boot |
| **Order** | Order processing | 8081 | Spring Boot |
| **Notification** | Real-time notifications | 8083 | Spring Boot + WebSocket |

### **Data Layer**

| Service | Purpose | Port | Storage |
|---------|---------|------|---------|
| **MySQL** | Primary database | 3306 | 1Gi persistent volume |
| **Redis** | Caching layer | 6379 | 1Gi persistent volume |

### **Infrastructure Services**

| Service | Purpose | Port | Technology |
|---------|---------|------|------------|
| **Kafka** | Message broker | 9092 | Helm Chart |
| **Vault** | Secrets management | 8200 | HashiCorp Vault |

## üîê Security Features

### **Network Security**
- Private subnets for worker nodes
- Security groups with minimal access
- NAT Gateway for outbound internet
- No direct internet access to pods

### **IAM Security**
- Least privilege access
- Proper IAM roles for EKS
- Service accounts for applications
- Encrypted secrets management

### **Application Security**
- Vault for secrets management
- TLS encryption for communications
- RBAC for Kubernetes resources
- Network policies for pod-to-pod communication

## üìä Monitoring and Management

### **Health Checks**

```bash
# Traditional deployment
kubectl get pods
kubectl get services
kubectl get ingress

# Knative deployment
kubectl get ksvc
kubectl get gateway
kubectl get virtualservice
```

### **Logs and Debugging**

```bash
# View service logs
kubectl logs -l app=<service-name>

# Check events
kubectl get events --sort-by='.lastTimestamp'

# Monitor resources
kubectl top pods
kubectl top nodes
```

## üßπ Cleanup

### **Application Cleanup**

```bash
# Traditional deployment cleanup
./cleanup_stateful.sh

# Knative deployment cleanup
./cleanup_knative.sh
```

### **Infrastructure Cleanup**

```bash
# Remove all infrastructure
cd terraform
terraform destroy
```

## üìö Documentation

- **[Terraform README](terraform/README.md)** - Infrastructure setup and configuration
- **[Knative README](knative/README.md)** - Knative + Istio deployment guide
- **[Kafka README](kafka/README.md)** - Kafka Helm chart deployment
- **[Vault README](vault/README.md)** - Vault secrets management setup

## üîó Key Features

### **Infrastructure**
- ‚úÖ **Terraform AWS Modules** for reliable infrastructure
- ‚úÖ **Multi-AZ deployment** for high availability
- ‚úÖ **Auto-scaling** node groups
- ‚úÖ **EBS CSI Driver** for persistent storage
- ‚úÖ **Karpenter-ready** configuration

### **Application**
- ‚úÖ **Microservices architecture** with clear separation
- ‚úÖ **Event-driven communication** with Kafka
- ‚úÖ **Real-time notifications** with WebSocket
- ‚úÖ **Authentication and authorization** service
- ‚úÖ **API Gateway** pattern implementation

### **Operations**
- ‚úÖ **Automated deployment** scripts
- ‚úÖ **Health monitoring** and checks
- ‚úÖ **Easy cleanup** procedures
- ‚úÖ **Comprehensive documentation**
- ‚úÖ **Production-ready** configurations

## üöÄ Next Steps

### **Development**
1. Customize service configurations
2. Add application-specific environment variables
3. Implement CI/CD pipelines
4. Add monitoring and alerting

### **Production**
1. Configure SSL certificates
2. Set up monitoring (Prometheus, Grafana)
3. Implement backup strategies
4. Configure disaster recovery
5. Set up logging (ELK stack)

### **Advanced Features**
1. Implement service mesh policies
2. Add distributed tracing
3. Configure advanced auto-scaling
4. Implement blue-green deployments
5. Add chaos engineering practices

## üìû Support

For issues and questions:
1. Check the specific README files in each directory
2. Review Kubernetes, Knative, and Istio documentation
3. Check AWS EKS documentation
4. Verify Terraform configurations

## üìÑ License

This project is provided as-is for educational and demonstration purposes. 